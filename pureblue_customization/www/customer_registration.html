<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Registration</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        :root {
            --primary: #083278;
            --text-dark: #1f272e;
            --text-muted: #6c7680;
            --border: #e3e8ee;
            --bg-light: #f7f9fc;
            --bg-white: #ffffff;
            --success: #48bb74;
            --danger: #f56b6b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            min-height: 100vh;
            padding: 20px;
        }
        .customer-registration-container {
            max-width: 1000px;
            margin: 40px auto;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .page-header {
            margin-bottom: 32px;
            text-align: center;
        }
        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            margin: 0;
        }
        .page-subtitle {
            font-size: 15px;
            color: var(--text-muted);
            margin-top: 8px;
        }
        .form-section {
            background: var(--bg-white);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        .form-section:hover {
            box-shadow: 0 4px 16px rgba(8, 50, 120, 0.12);
            transform: translateY(-2px);
        }
        .section-header {
            display: flex;
            align-items: center;
            margin: -24px -24px 20px -24px;
            padding: 18px 24px;
            background: linear-gradient(135deg, var(--primary) 0%, #0a4a9e 100%);
            border-radius: 12px 12px 0 0;
        }
        .section-icon {
            width: 22px;
            height: 22px;
            margin-right: 12px;
            color: white;
        }
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: white;
            margin: 0;
        }
        .form-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-dark);
            margin-bottom: 6px;
            display: block;
        }
        .required-indicator {
            color: var(--danger);
            margin-left: 2px;
        }
        .form-control, .form-select {
            width: 100%;
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg-white);
            color: var(--text-dark);
            transition: all 0.2s ease;
        }
        .form-control[type="file"] {
            padding: 10px 14px;
            cursor: pointer;
            border: 2px dashed var(--border);
            background-color: #fafbfc;
        }
        .form-control:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(8, 50, 120, 0.1);
        }
        .form-control.is-invalid, .form-select.is-invalid {
            border-color: var(--danger);
            background-color: #fff5f5;
        }
        .invalid-feedback {
            color: var(--danger);
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }
        .form-control.is-invalid + .invalid-feedback,
        .form-select.is-invalid + .invalid-feedback {
            display: block;
        }
        .alert {
            padding: 18px 24px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 14px;
            animation: slideDown 0.4s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 2px solid;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .alert-success {
            background: linear-gradient(135deg, #e8f7ed 0%, #d4f0dd 100%);
            color: #1e6f3e;
            border-color: #a8dfc0;
        }
        .alert-danger {
            background: linear-gradient(135deg, #fef0f0 0%, #fce4e4 100%);
            color: #b33535;
            border-color: #f5b8b8;
        }
        .d-none { display: none !important; }
        .mb-3 { margin-bottom: 20px; }
        .row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }
        .col-md-6 {
            flex: 0 0 50%;
            max-width: 50%;
            padding: 0 10px;
        }
        .col-md-12 {
            flex: 0 0 100%;
            max-width: 100%;
            padding: 0 10px;
        }
        .form-text {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 6px;
            display: block;
            font-style: italic;
        }
        .address-card {
            background: linear-gradient(135deg, #f8f9fc 0%, #f0f3f8 100%);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 24px;
        }
        .address-label {
            font-size: 14px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 20px;
        }
        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        .btn {
            padding: 12px 28px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #0a4a9e 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(8, 50, 120, 0.2);
        }
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(8, 50, 120, 0.35);
        }
        .btn-secondary {
            background-color: white;
            color: var(--text-dark);
            border: 2px solid var(--border);
        }
        .btn-secondary:hover:not(:disabled) {
            background-color: var(--bg-light);
            border-color: var(--primary);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-loading {
            position: relative;
            color: transparent;
        }
        .btn-loading::after {
            content: "";
            position: absolute;
            width: 18px;
            height: 18px;
            top: 50%;
            left: 50%;
            margin-left: -9px;
            margin-top: -9px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @media (max-width: 768px) {
            .col-md-6 { flex: 0 0 100%; max-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="customer-registration-container">
        <div class="page-header">
            <h1 class="page-title">Customer Registration</h1>
            <p class="page-subtitle">Please fill in the details below to register as a customer</p>
        </div>

        <div id="response-message" class="alert d-none" role="alert"></div>

        <form id="customer-form" novalidate>
            <div class="form-section">
                <div class="section-header">
                    <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <h2 class="section-title">Basic Information</h2>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="customer_name" class="form-label">Customer Name <span class="required-indicator">*</span></label>
                        <input type="text" id="customer_name" class="form-control" placeholder="Enter customer name" minlength="3">
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="customer_group" class="form-label">Customer Group</label>
                        <select id="customer_group" class="form-select"><option>Loading...</option></select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="customer_type" class="form-label">Customer Type</label>
                        <select id="customer_type" class="form-select">
                            <option value="Company">Company</option>
                            <option value="Individual">Individual</option>
                            <option value="Partnership">Partnership</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="tax_id" class="form-label">Tax ID / GSTIN</label>
                        <input type="text" id="tax_id" class="form-control" placeholder="27ABCDE1234F1Z5" maxlength="15" style="text-transform:uppercase;">
                        <div class="invalid-feedback"></div>
                        <small class="form-text">15 characters: 27ABCDE1234F1Z5</small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="licence_no" class="form-label">Licence No <span class="required-indicator">*</span></label>
                        <input type="text" id="licence_no" class="form-control" placeholder="Enter licence number">
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="licence_expiry" class="form-label">Licence Expiry <span class="required-indicator">*</span></label>
                        <input type="date" id="licence_expiry" class="form-control">
                        <div class="invalid-feedback"></div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label for="document_file" class="form-label">Drug License Document <span class="required-indicator">*</span></label>
                        <input type="file" id="document_file" class="form-control" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx">
                        <div class="invalid-feedback"></div>
                        <small class="form-text">PDF, JPG, PNG, DOC, DOCX (Max 5MB)</small>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="section-header">
                    <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                    </svg>
                    <h2 class="section-title">Contact Information</h2>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="email" class="form-label">Email <span class="required-indicator">*</span></label>
                        <input type="email" id="email" class="form-control" placeholder="email@example.com">
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="phone" class="form-label">Phone</label>
                        <input type="text" id="phone" class="form-control" placeholder="+91 12345 67890">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="mobile" class="form-label">Mobile</label>
                        <input type="text" id="mobile" class="form-control" placeholder="+91 98765 43210">
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="website" class="form-label">Website</label>
                        <input type="text" id="website" class="form-control" placeholder="https://example.com">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="section-header">
                    <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                    </svg>
                    <h2 class="section-title">Address Details</h2>
                </div>
                <div class="address-card">
                    <div class="address-label">Primary Address</div>
                    <div class="mb-3">
                        <label for="address_line1" class="form-label">Address Line 1</label>
                        <input type="text" id="address_line1" class="form-control" placeholder="Street address">
                    </div>
                    <div class="mb-3">
                        <label for="address_line2" class="form-label">Address Line 2</label>
                        <input type="text" id="address_line2" class="form-control" placeholder="Apartment, suite, etc.">
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="city" class="form-label">City</label>
                            <input type="text" id="city" class="form-control" placeholder="City">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="state" class="form-label">State</label>
                            <input type="text" id="state" class="form-control" placeholder="State">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="pincode" class="form-label">PIN Code</label>
                            <input type="text" id="pincode" class="form-control" placeholder="123456" maxlength="6">
                            <div class="invalid-feedback"></div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="country" class="form-label">Country</label>
                            <input type="text" id="country" class="form-control" value="India">
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="section-header">
                    <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                        <line x1="1" y1="10" x2="23" y2="10"></line>
                    </svg>
                    <h2 class="section-title">Bank Details</h2>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="bank_name" class="form-label">Bank Name</label>
                        <select id="bank_name" class="form-select"><option>Loading...</option></select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="bank_account_no" class="form-label">Account Number</label>
                        <input type="text" id="bank_account_no" class="form-control" placeholder="Enter account number" minlength="9" maxlength="18">
                        <div class="invalid-feedback"></div>
                        <small class="form-text">9 to 18 digits</small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="ifsc_code" class="form-label">IFSC Code</label>
                        <input type="text" id="ifsc_code" class="form-control" style="text-transform:uppercase;" placeholder="HDFC0001234" maxlength="11">
                        <div class="invalid-feedback"></div>
                        <small class="form-text">11 chars: HDFC0001234</small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="branch_name" class="form-label">Branch Name</label>
                        <input type="text" id="branch_name" class="form-control" placeholder="Branch name">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="account_holder_name" class="form-label">Account Holder Name</label>
                        <input type="text" id="account_holder_name" class="form-control" placeholder="As per bank records">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="bank_account_type" class="form-label">Account Type</label>
                        <select id="bank_account_type" class="form-select">
                            <option value="">Select type</option>
                            <option value="Current">Current</option>
                            <option value="Savings">Savings</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary" id="submit-btn">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    Submit
                </button>
                <button type="button" class="btn btn-secondary" id="cancel-btn">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                    Cancel
                </button>
            </div>
        </form>
    </div>

<script>
$(function() {
    // Load options
    $.get("/api/method/pureblue_customization.www.customer_registration.get_customer_groups", function(r) {
        const $s = $("#customer_group").empty();
        (r.message || []).forEach(g => $s.append($("<option>").val(g).text(g)));
    });
    $.get("/api/method/pureblue_customization.www.customer_registration.get_banks", function(r) {
        const $s = $("#bank_name").empty();
        (r.message || ["HDFC"]).forEach(b => $s.append($("<option>").val(b).text(b)));
    });

    // Uppercase inputs
    $('#ifsc_code, #tax_id').on('input', function() { this.value = this.value.toUpperCase(); });

    // Show error on field
    function showError($f, msg) {
        $f.addClass('is-invalid').next('.invalid-feedback').text(msg);
        $f[0].scrollIntoView({behavior: 'smooth', block: 'center'});
    }

    // Clear errors
    $('input, select').on('focus', function() { $(this).removeClass('is-invalid'); });

    // Cancel
    $('#cancel-btn').click(function() {
        if (confirm('Clear form?')) {
            $('#customer-form')[0].reset();
            $('#country').val('India');
            $('.is-invalid').removeClass('is-invalid');
            $('#response-message').addClass('d-none');
        }
    });

    // Submit
    $('#customer-form').submit(function(e) {
        e.preventDefault();
        $('.is-invalid').removeClass('is-invalid');

        const $btn = $('#submit-btn'), $cancel = $('#cancel-btn');
        $btn.addClass('btn-loading').prop('disabled', true);
        $cancel.prop('disabled', true);

        const fd = new FormData();
        const data = {
            customer_name: $('#customer_name').val(),
            customer_group: $('#customer_group').val(),
            customer_type: $('#customer_type').val(),
            tax_id: $('#tax_id').val(),
            licence_no: $('#licence_no').val(),
            licence_expiry: $('#licence_expiry').val(),
            email: $('#email').val(),
            phone: $('#phone').val(),
            mobile: $('#mobile').val(),
            website: $('#website').val(),
            address: {
                address_line1: $('#address_line1').val(),
                address_line2: $('#address_line2').val(),
                city: $('#city').val(),
                state: $('#state').val(),
                pincode: $('#pincode').val(),
                country: $('#country').val()
            },
            bank_details: {
                bank_name: $('#bank_name').val(),
                bank_account_no: $('#bank_account_no').val(),
                ifsc_code: $('#ifsc_code').val(),
                branch_name: $('#branch_name').val(),
                account_holder_name: $('#account_holder_name').val(),
                bank_account_type: $('#bank_account_type').val()
            }
        };

        fd.append('data', JSON.stringify(data));
        const file = document.getElementById('document_file').files[0];
        if (file) {
            fd.append('file', file);
            fd.append('filename', file.name);
        }

        $.ajax({
            url: '/api/method/pureblue_customization.www.customer_registration.create_customer',
            type: 'POST',
            data: fd,
            processData: false,
            contentType: false,
            headers: typeof frappe !== 'undefined' ? {'X-Frappe-CSRF-Token': frappe.csrf_token} : {},
            success: function(r) {
                $btn.removeClass('btn-loading').prop('disabled', false);
                $cancel.prop('disabled', false);
                
                const res = r.message;
                const $msg = $('#response-message');
                
                if (res && res.success) {
                    $msg.removeClass('d-none alert-danger').addClass('alert-success').html('<span>' + res.message + '</span>');
                    $('#customer-form')[0].reset();
                    $('#country').val('India');
                } else {
                    $msg.removeClass('d-none alert-success').addClass('alert-danger').html('<span>' + (res.message || 'Error occurred') + '</span>');
                    
                    // Highlight field if specified
                    if (res.field) {
                        const $field = $('#' + res.field);
                        if ($field.length) showError($field, res.message);
                    }
                }
                window.scrollTo({top: 0, behavior: 'smooth'});
            },
            error: function(xhr) {
                $btn.removeClass('btn-loading').prop('disabled', false);
                $cancel.prop('disabled', false);
                
                let errMsg = 'Server error. Please try again.';
                try {
                    const err = JSON.parse(xhr.responseText);
                    if (err.message) errMsg = err.message;
                } catch(e) {}
                
                $('#response-message').removeClass('d-none alert-success').addClass('alert-danger').html('<span>' + errMsg + '</span>');
                window.scrollTo({top: 0, behavior: 'smooth'});
            }
        });
    });
});
</script>
</body>
</html>